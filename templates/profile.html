{% extends "base.html" %}

{% block title %}Profile - StudyZee{% endblock %}

{% block content %}
<div class="profile-wrapper">
    <!-- Profile Header -->
    <div class="profile-header">
        <div class="profile-header-content">
            <div class="profile-avatar-section">
                <div class="avatar-wrapper">
                    <img src="{{ user.profile_picture or url_for('static', filename='images/default-pfp.jpg') }}" 
                         alt="Profile Picture" 
                         class="avatar-img" 
                         id="profile-pic">
                    <button class="avatar-edit-btn" id="update-pic-btn" title="Change profile picture">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M15 8L12 5L5 12V15H8L15 8Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12.5 5.5L14.5 7.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
                <div class="profile-user-info">
                    <h1 class="profile-name">{{ user.full_name }}</h1>
                    <p class="profile-username">@{{ user.username }}</p>
                    <button class="edit-name-btn" id="edit-name-btn">Edit Name</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Form -->
    <div class="profile-container">
        <form method="POST" action="{{ url_for('social.edit_profile') }}" class="profile-form">
            <h2 class="form-section-title">Personal Information</h2>
            
            <div class="form-grid">
                <!-- Left Column -->
                <div class="form-section">
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" value="{{ user.email }}" disabled class="form-input disabled">
                    </div>

                    <div class="form-group">
                        <label for="year_of_study">Study Year</label>
                        <input type="number" 
                               id="year_of_study" 
                               name="year_of_study" 
                               value="{{ user.study_year or '' }}" 
                               min="1" 
                               max="10" 
                               placeholder="Enter your year"
                               class="form-input">
                    </div>

                    <div class="form-group">
                        <label for="ethnicity">Ethnicity</label>
                        <select name="ethnicity" id="ethnicity" class="form-select">
                            <option value="">Select your ethnicity</option>
                            <option value="Asian" {% if user.ethnicity == 'Asian' %}selected{% endif %}>Asian</option>
                            <option value="Black" {% if user.ethnicity == 'Black' %}selected{% endif %}>Black</option>
                            <option value="Hispanic/Latino" {% if user.ethnicity == 'Hispanic/Latino' %}selected{% endif %}>Hispanic/Latino</option>
                            <option value="White" {% if user.ethnicity == 'White' %}selected{% endif %}>White</option>
                            <option value="South Asian" {% if user.ethnicity == 'South Asian' %}selected{% endif %}>South Asian</option>
                            <option value="Middle Eastern/North African" {% if user.ethnicity == 'Middle Eastern/North African' %}selected{% endif %}>Middle Eastern/North African</option>
                            <option value="Indigenous American" {% if user.ethnicity == 'Indigenous American' %}selected{% endif %}>Indigenous American</option>
                            <option value="Pacific Islander" {% if user.ethnicity == 'Pacific Islander' %}selected{% endif %}>Pacific Islander</option>
                            <option value="Jewish" {% if user.ethnicity == 'Jewish' %}selected{% endif %}>Jewish</option>
                            <option value="African" {% if user.ethnicity == 'African' %}selected{% endif %}>African</option>
                            <option value="East Asian" {% if user.ethnicity == 'East Asian' %}selected{% endif %}>East Asian</option>
                            <option value="Central Asian" {% if user.ethnicity == 'Central Asian' %}selected{% endif %}>Central Asian</option>
                            <option value="Caribbean" {% if user.ethnicity == 'Caribbean' %}selected{% endif %}>Caribbean</option>
                            <option value="Other" {% if user.ethnicity == 'Other' %}selected{% endif %}>Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="major">Major</label>
                        <select name="major" id="major" class="form-select">
                            <option value="">Select your major</option>
                            <option value="business-management" {% if user.major == 'business-management' %}selected{% endif %}>Business & Management</option>
                            <option value="cs-it-data-science" {% if user.major == 'cs-it-data-science' %}selected{% endif %}>Computer Science, IT & Data Science</option>
                            <option value="engineering-technology" {% if user.major == 'engineering-technology' %}selected{% endif %}>Engineering & Technology</option>
                            <option value="mathematics-statistics" {% if user.major == 'mathematics-statistics' %}selected{% endif %}>Mathematics & Statistics</option>
                            <option value="natural-environmental-sciences" {% if user.major == 'natural-environmental-sciences' %}selected{% endif %}>Natural Sciences & Environmental Studies</option>
                            <option value="health-sciences-medicine" {% if user.major == 'health-sciences-medicine' %}selected{% endif %}>Health Sciences, Nursing & Medicine</option>
                            <option value="pharmacy-pharmaceutical-sciences" {% if user.major == 'pharmacy-pharmaceutical-sciences' %}selected{% endif %}>Pharmacy & Pharmaceutical Sciences</option>
                            <option value="education-teaching" {% if user.major == 'education-teaching' %}selected{% endif %}>Education & Teaching</option>
                            <option value="law-legal-studies" {% if user.major == 'law-legal-studies' %}selected{% endif %}>Law & Legal Studies</option>
                            <option value="social-sciences-humanities" {% if user.major == 'social-sciences-humanities' %}selected{% endif %}>Social Sciences & Humanities</option>
                            <option value="economics-finance" {% if user.major == 'economics-finance' %}selected{% endif %}>Economics & Finance</option>
                            <option value="architecture-urban-planning" {% if user.major == 'architecture-urban-planning' %}selected{% endif %}>Architecture & Urban Planning</option>
                            <option value="fine-arts-design" {% if user.major == 'fine-arts-design' %}selected{% endif %}>Fine Arts & Design</option>
                            <option value="communications-media-studies" {% if user.major == 'communications-media-studies' %}selected{% endif %}>Communications & Media Studies</option>
                            <option value="agriculture-forestry" {% if user.major == 'agriculture-forestry' %}selected{% endif %}>Agriculture & Forestry</option>
                            <option value="hospitality-tourism" {% if user.major == 'hospitality-tourism' %}selected{% endif %}>Hospitality & Tourism</option>
                        </select>
                    </div>
                </div>

                <!-- Right Column -->
                <div class="form-section">
                    <div class="form-group">
                        <label for="study_level">Study Level</label>
                        <select name="study_level" id="study_level" class="form-select">
                            <option value="">Select your level of study</option>
                            <option value="undergraduate" {% if user.study_level == 'undergraduate' %}selected{% endif %}>Undergraduate</option>
                            <option value="masters" {% if user.study_level == 'masters' %}selected{% endif %}>Masters</option>
                            <option value="phd" {% if user.study_level == 'phd' %}selected{% endif %}>PhD</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="home_country">Home Country</label>
                        <select name="home_country" id="home_country" class="form-select">
                            <option value="">Select your country</option>
                            {% for country in ['Afghanistan', 'Albania', 'Algeria', 'Andorra', 'Angola', 'Argentina', 'Armenia', 'Australia', 'Austria', 'Azerbaijan', 'Bahamas', 'Bahrain', 'Bangladesh', 'Barbados', 'Belarus', 'Belgium', 'Belize', 'Benin', 'Bhutan', 'Bolivia', 'Bosnia and Herzegovina', 'Botswana', 'Brazil', 'Brunei', 'Bulgaria', 'Burkina Faso', 'Burundi', 'Cambodia', 'Cameroon', 'Canada', 'Cape Verde', 'Central African Republic', 'Chad', 'Chile', 'China', 'Colombia', 'Comoros', 'Congo', 'Costa Rica', 'Croatia', 'Cuba', 'Cyprus', 'Czech Republic', 'Denmark', 'Djibouti', 'Dominican Republic', 'Ecuador', 'Egypt', 'El Salvador', 'Equatorial Guinea', 'Eritrea', 'Estonia', 'Eswatini', 'Ethiopia', 'Fiji', 'Finland', 'France', 'Gabon', 'Gambia', 'Georgia', 'Germany', 'Ghana', 'Greece', 'Grenada', 'Guatemala', 'Guinea', 'Guinea-Bissau', 'Guyana', 'Haiti', 'Honduras', 'Hungary', 'Iceland', 'India', 'Indonesia', 'Iran', 'Iraq', 'Ireland', 'Israel', 'Italy', 'Jamaica', 'Japan', 'Jordan', 'Kazakhstan', 'Kenya', 'Kiribati', 'Kuwait', 'Kyrgyzstan', 'Laos', 'Latvia', 'Lebanon', 'Lesotho', 'Liberia', 'Libya', 'Liechtenstein', 'Lithuania', 'Luxembourg', 'Madagascar', 'Malawi', 'Malaysia', 'Maldives', 'Mali', 'Malta', 'Marshall Islands', 'Mauritania', 'Mauritius', 'Mexico', 'Micronesia', 'Moldova', 'Monaco', 'Mongolia', 'Montenegro', 'Morocco', 'Mozambique', 'Myanmar', 'Namibia', 'Nauru', 'Nepal', 'Netherlands', 'New Zealand', 'Nicaragua', 'Niger', 'Nigeria', 'North Korea', 'North Macedonia', 'Norway', 'Oman', 'Pakistan', 'Palau', 'Panama', 'Papua New Guinea', 'Paraguay', 'Peru', 'Philippines', 'Poland', 'Portugal', 'Qatar', 'Romania', 'Russia', 'Rwanda', 'Saint Kitts and Nevis', 'Saint Lucia', 'Saint Vincent and the Grenadines', 'Samoa', 'San Marino', 'Saudi Arabia', 'Senegal', 'Serbia', 'Seychelles', 'Sierra Leone', 'Singapore', 'Slovakia', 'Slovenia', 'Solomon Islands', 'Somalia', 'South Africa', 'Spain', 'Sudan', 'Sweden', 'Switzerland', 'Syria', 'Tajikistan', 'Tanzania', 'Thailand', 'Timor-Leste', 'Togo', 'Tonga', 'Trinidad and Tobago', 'Tunisia', 'Turkey', 'Turkmenistan', 'Tuvalu', 'Uganda', 'Ukraine', 'United Arab Emirates', 'United Kingdom', 'United States', 'Uruguay', 'Uzbekistan', 'Vanuatu', 'Vatican City', 'Venezuela', 'Vietnam', 'Yemen', 'Zambia', 'Zimbabwe'] %}
                            <option value="{{ country }}" {% if user.home_country == country %}selected{% endif %}>{{ country }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="gender">Gender</label>
                        <select name="gender" id="gender" class="form-select">
                            <option value="">Select your gender</option>
                            <option value="Male" {% if user.gender == 'Male' %}selected{% endif %}>Male</option>
                            <option value="Female" {% if user.gender == 'Female' %}selected{% endif %}>Female</option>
                            <option value="Non-binary" {% if user.gender == 'Non-binary' %}selected{% endif %}>Non-binary</option>
                            <option value="Genderqueer" {% if user.gender == 'Genderqueer' %}selected{% endif %}>Genderqueer</option>
                            <option value="Genderfluid" {% if user.gender == 'Genderfluid' %}selected{% endif %}>Genderfluid</option>
                            <option value="Agender" {% if user.gender == 'Agender' %}selected{% endif %}>Agender</option>
                            <option value="Prefer not to say" {% if user.gender == 'Prefer not to say' %}selected{% endif %}>Prefer not to say</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="academic_goal">Academic Goal</label>
                        <select name="academic_goal" id="academic_goal" class="form-select">
                            <option value="">Select your goal</option>
                            <option value="Graduate with honors" {% if user.academic_goal == 'Graduate with honors' %}selected{% endif %}>Graduate with honors</option>
                            <option value="Get a research position" {% if user.academic_goal == 'Get a research position' %}selected{% endif %}>Get a research position</option>
                            <option value="Start a business" {% if user.academic_goal == 'Start a business' %}selected{% endif %}>Start a business</option>
                            <option value="Pursue higher education" {% if user.academic_goal == 'Pursue higher education' %}selected{% endif %}>Pursue higher education</option>
                            <option value="Secure a job in my field" {% if user.academic_goal == 'Secure a job in my field' %}selected{% endif %}>Secure a job in my field</option>
                            <option value="Develop technical skills" {% if user.academic_goal == 'Develop technical skills' %}selected{% endif %}>Develop technical skills</option>
                            <option value="Gain international experience" {% if user.academic_goal == 'Gain international experience' %}selected{% endif %}>Gain international experience</option>
                            <option value="Contribute to community service" {% if user.academic_goal == 'Contribute to community service' %}selected{% endif %}>Contribute to community service</option>
                            <option value="Publish academic papers" {% if user.academic_goal == 'Publish academic papers' %}selected{% endif %}>Publish academic papers</option>
                            <option value="Network with professionals" {% if user.academic_goal == 'Network with professionals' %}selected{% endif %}>Network with professionals</option>
                            <option value="Other" {% if user.academic_goal == 'Other' %}selected{% endif %}>Other</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="form-actions">
                <a href="{{ url_for('dashboard.dashboard') }}" class="btn btn-secondary">Cancel</a>
                <button type="submit" class="btn btn-primary">Save Changes</button>
            </div>
        </form>
    </div>
</div>

<!-- Profile Picture Upload Modal -->
<div id="profile-pic-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Update Profile Picture</h3>
            <button class="modal-close" id="close-pic-modal">&times;</button>
        </div>
        <form id="update-pic-form" method="POST" action="{{ url_for('social.update_pic') }}" enctype="multipart/form-data">
            <div class="modal-body">
                <div class="file-upload-area">
                    <input type="file" name="profile_pic" id="file-input" accept="image/*" required hidden>
                    <label for="file-input" class="file-upload-label">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M17 8L12 3L7 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12 3V15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>Click to upload image</span>
                        <span class="file-name" id="file-name"></span>
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancel-pic-upload">Cancel</button>
                <button type="submit" class="btn btn-primary">Upload</button>
            </div>
        </form>
    </div>
</div>

<!-- Edit Name Modal -->
<div id="edit-name-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Change Name</h3>
            <button class="modal-close" id="close-name-modal">&times;</button>
        </div>
        <form method="POST" action="{{ url_for('social.change_name') }}">
            <div class="modal-body">
                <div class="form-group">
                    <label for="new_name">Full Name</label>
                    <input type="text" name="new_name" id="new_name" value="{{ user.full_name }}" required class="form-input">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancel-name-edit">Cancel</button>
                <button type="submit" class="btn btn-primary">Save</button>
            </div>
        </form>
    </div>
</div>

<style>
* {
    box-sizing: border-box;
}

.profile-wrapper {
    min-height: 100vh;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding-bottom: 60px;
}

.profile-header {
    background: white;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    padding: 40px 20px;
}

.profile-header-content {
    max-width: 1200px;
    margin: 0 auto;
}

.profile-avatar-section {
    display: flex;
    align-items: center;
    gap: 30px;
}

.avatar-wrapper {
    position: relative;
}

.avatar-img {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    object-fit: cover;
    border: 4px solid #667eea;
}

.avatar-edit-btn {
    position: absolute;
    bottom: 0;
    right: 0;
    background: #667eea;
    color: white;
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    transition: all 0.3s ease;
}

.avatar-edit-btn:hover {
    background: #5568d3;
    transform: scale(1.1);
}

.profile-user-info {
    flex: 1;
}

.profile-name {
    font-size: 32px;
    font-weight: 700;
    color: #2d3748;
    margin: 0 0 5px 0;
}

.profile-username {
    font-size: 16px;
    color: #718096;
    margin: 0 0 15px 0;
}

.edit-name-btn {
    background: transparent;
    border: 2px solid #667eea;
    color: #667eea;
    padding: 8px 20px;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.edit-name-btn:hover {
    background: #667eea;
    color: white;
}

.profile-container {
    max-width: 1200px;
    margin: 40px auto;
    background: white;
    border-radius: 16px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
    padding: 40px;
}

.form-section-title {
    font-size: 24px;
    font-weight: 700;
    color: #2d3748;
    margin: 0 0 30px 0;
    padding-bottom: 15px;
    border-bottom: 2px solid #e2e8f0;
}

.form-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 40px;
    margin-bottom: 30px;
}

.form-section {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.form-group {
    display: flex;
    flex-direction: column;
}

.form-group label {
    font-size: 14px;
    font-weight: 600;
    color: #4a5568;
    margin-bottom: 8px;
}

.form-input,
.form-select {
    padding: 12px 16px;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    font-size: 15px;
    color: #2d3748;
    background: white;
    transition: all 0.3s ease;
    font-family: inherit;
}

.form-input:focus,
.form-select:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.form-input.disabled {
    background: #f7fafc;
    color: #a0aec0;
    cursor: not-allowed;
}

.form-select {
    cursor: pointer;
}

.form-actions {
    display: flex;
    justify-content: flex-end;
    gap: 15px;
    padding-top: 30px;
    border-top: 2px solid #e2e8f0;
}

.btn {
    padding: 12px 32px;
    border-radius: 8px;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    border: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

.btn-primary {
    background: #667eea;
    color: white;
}

.btn-primary:hover {
    background: #5568d3;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}

.btn-secondary {
    background: #e2e8f0;
    color: #4a5568;
}

.btn-secondary:hover {
    background: #cbd5e0;
}

/* Modal Styles */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
}

.modal.active {
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-content {
    background: white;
    border-radius: 16px;
    width: 90%;
    max-width: 500px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    animation: modalSlideIn 0.3s ease;
}

@keyframes modalSlideIn {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.modal-header {
    padding: 24px 24px 16px;
    border-bottom: 2px solid #e2e8f0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h3 {
    margin: 0;
    font-size: 20px;
    font-weight: 700;
    color: #2d3748;
}

.modal-close {
    background: transparent;
    border: none;
    font-size: 28px;
    color: #a0aec0;
    cursor: pointer;
    line-height: 1;
    padding: 0;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    transition: all 0.2s ease;
}

.modal-close:hover {
    background: #f7fafc;
    color: #4a5568;
}

.modal-body {
    padding: 24px;
}

.modal-footer {
    padding: 16px 24px;
    border-top: 2px solid #e2e8f0;
    display: flex;
    justify-content: flex-end;
    gap: 12px;
}

.file-upload-area {
    border: 2px dashed #cbd5e0;
    border-radius: 12px;
    padding: 40px;
    text-align: center;
    transition: all 0.3s ease;
}

.file-upload-area:hover {
    border-color: #667eea;
    background: #f7fafc;
}

.file-upload-label {
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    color: #667eea;
}

.file-upload-label svg {
    color: #667eea;
}

.file-upload-label span {
    font-size: 15px;
    font-weight: 600;
}

.file-name {
    font-size: 13px;
    color: #718096;
    font-weight: 400;
}

@media (max-width: 768px) {
    .form-grid {
        grid-template-columns: 1fr;
        gap: 20px;
    }
    
    .profile-avatar-section {
        flex-direction: column;
        text-align: center;
    }
    
    .profile-container {
        padding: 24px;
        margin: 20px;
    }
    
    .form-actions {
        flex-direction: column;
    }
    
    .btn {
        width: 100%;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Profile Picture Modal
    const picModal = document.getElementById('profile-pic-modal');
    const updatePicBtn = document.getElementById('update-pic-btn');
    const closePicModal = document.getElementById('close-pic-modal');
    const cancelPicUpload = document.getElementById('cancel-pic-upload');
    
    updatePicBtn.addEventListener('click', () => {
        picModal.classList.add('active');
    });
    
    closePicModal.addEventListener('click', () => {
        picModal.classList.remove('active');
    });
    
    cancelPicUpload.addEventListener('click', () => {
        picModal.classList.remove('active');
    });
    
    // Edit Name Modal
    const nameModal = document.getElementById('edit-name-modal');
    const editNameBtn = document.getElementById('edit-name-btn');
    const closeNameModal = document.getElementById('close-name-modal');
    const cancelNameEdit = document.getElementById('cancel-name-edit');
    
    editNameBtn.addEventListener('click', () => {
        nameModal.classList.add('active');
    });
    
    closeNameModal.addEventListener('click', () => {
        nameModal.classList.remove('active');
    });
    
    cancelNameEdit.addEventListener('click', () => {
        nameModal.classList.remove('active');
    });
    
    // Close modals on outside click
    window.addEventListener('click', (e) => {
        if (e.target === picModal) {
            picModal.classList.remove('active');
        }
        if (e.target === nameModal) {
            nameModal.classList.remove('active');
        }
    });
    
    // File input preview
    const fileInput = document.getElementById('file-input');
    const fileName = document.getElementById('file-name');
    
    fileInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
            fileName.textContent = e.target.files[0].name;
        }
    });
});
</script>

{% endblock %}

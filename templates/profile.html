{% extends "base.html" %}

{% block title %}Edit Profile{% endblock %}

{% block content %}
<div class="profile-container">
    <h2>Edit Your Profile</h2>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="flash {{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}


    <img src="{{ user.profile_picture or url_for('static', filename='images/default-pfp.jpg') }}" alt="Profile Picture">
    <button id="edit-profile-pic-btn">Edit Profile Picture</button>


    <div id="profile-pic-popup" class="popup">
        <div class="popup-content">
            <span class="close-btn">&times;</span>
            <h3>Update Profile Picture</h3>
            <form id="update-pic-form" method="POST" action="/update_pic" enctype="multipart/form-data">
                <input type="file" name="profile_pic" accept="image/*" required>
                <button type="submit">Update Picture</button>
            </form>
        </div>
    </div>

    <script>
        document.getElementById('edit-profile-pic-btn').addEventListener('click', function() {
            document.getElementById('profile-pic-popup').style.display = 'block';
        });

        document.querySelector('.close-btn').addEventListener('click', function() {
            document.getElementById('profile-pic-popup').style.display = 'none';
        });

        window.addEventListener('click', function(event) {
            if (event.target == document.getElementById('profile-pic-popup')) {
                document.getElementById('profile-pic-popup').style.display = 'none';
            }
        });
    </script>

    <form method="POST">
        <label for="name">Full Name:</label>
        <input type="text" name="name" value="{{ user.full_name or '' }}" required>

        <label for="study_level">Study Level:</label>
        <select name="study_level">
            <option value="Undergraduate" {% if user.study_level == 'Undergraduate' %}selected{% endif %}>Undergraduate</option>
            <option value="Postgraduate" {% if user.study_level == 'Postgraduate' %}selected{% endif %}>Postgraduate</option>
            <option value="PhD" {% if user.study_level == 'PhD' %}selected{% endif %}>PhD</option>
        </select>

        <label for="year_of_study">Year of Study:</label>
        <input type="number" name="year_of_study" value="{{ user.study_year or '' }}" min="1" max="10">

        <label for="major">Major:</label>
        <input type="text" name="major" value="{{ user.major or '' }}">

        <!-- Optional Fields -->
        <label for="home_country">Home Country:</label>
        <input type="text" name="home_country" value="{{ user.home_country or '' }}">

        <label for="ethnicity">Ethnicity:</label>
        <input type="text" name="ethnicity" value="{{ user.ethnicity or '' }}">

        <label for="gender">Gender:</label>
        <select name="gender">
            <option value="Male" {% if user.gender == 'Male' %}selected{% endif %}>Male</option>
            <option value="Female" {% if user.gender == 'Female' %}selected{% endif %}>Female</option>
            <option value="Other" {% if user.gender == 'Other' %}selected{% endif %}>Other</option>
        </select>

        <label for="academic_goal">Academic Goal:</label>
        <textarea name="academic_goal">{{ user.academic_goal or '' }}</textarea>

        <button type="submit">Save Changes</button>
    </form>

</div>
{% endblock %}

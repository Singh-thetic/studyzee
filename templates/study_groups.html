{% extends "base.html" %}
{% block title %}Study Groups - StudyZee{% endblock %}

{% block content %}
<div class="container">
  <div style="text-align: center; margin-bottom: 3rem;">
    <h1 class="page-title">Study Groups</h1>
    <p style="color: var(--gray-700); font-size: 1.125rem;">Collaborate and learn together</p>
  </div>

  <div class="grid grid-2" style="align-items: start;">
    <!-- Your Groups -->
    <div class="card">
      <h2 class="card-header">Your Groups</h2>
      
      {% if user_groups %}
      <div style="display: flex; flex-direction: column; gap: 1rem;">
        {% for g in user_groups %}
        <div style="background: var(--gray-50); 
                    padding: 1.5rem; 
                    border-radius: var(--radius-lg); 
                    border-left: 4px solid var(--primary);">
          <h3 style="font-size: 1.25rem; font-weight: 700; color: var(--gray-900); margin-bottom: 0.5rem;">
            {{ g.name }}
          </h3>
          <p style="color: var(--gray-600); margin-bottom: 1rem; font-size: 0.9375rem;">
            {{ g.description }}
          </p>
          <a href="{{ url_for('chat.group_chat', room_key=g.room_key) }}" class="btn btn-primary btn-sm">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
            Open Chat
          </a>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div style="text-align: center; padding: 3rem 1rem; color: var(--gray-500);">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" style="margin: 0 auto 1rem; opacity: 0.3;">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
          <circle cx="9" cy="7" r="4"></circle>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
        </svg>
        <p style="font-weight: 600; margin-bottom: 0.5rem;">No groups yet</p>
        <p style="font-size: 0.875rem;">Create or join a study group to get started</p>
      </div>
      {% endif %}
    </div>

    <!-- Right Column: Search & Create -->
    <div style="display: flex; flex-direction: column; gap: 1.5rem;">
      <!-- Search Groups -->
      <div class="card">
        <h2 class="card-header">Find a Group</h2>
        
        <form method="GET" action="{{ url_for('study_groups.study_groups') }}" style="display: flex; gap: 0.75rem;">
          <input type="text" 
                 name="search" 
                 class="form-input" 
                 placeholder="Search by group name..." 
                 value="{{ request.args.get('search', '') }}"
                 style="flex: 1;">
          <button type="submit" class="btn btn-primary">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
            Search
          </button>
        </form>

        <!-- Search Results -->
        {% if search_results is defined %}
        <div style="margin-top: 1.5rem;">
          {% if search_results|length == 0 %}
          <div style="text-align: center; padding: 2rem 1rem; color: var(--gray-500);">
            <p style="font-weight: 600;">No groups found</p>
            <p style="font-size: 0.875rem;">Try a different search term</p>
          </div>
          {% else %}
          <div style="display: flex; flex-direction: column; gap: 1rem;">
            {% for result in search_results %}
            <div style="background: var(--gray-50); padding: 1.25rem; border-radius: var(--radius-md);">
              <h3 style="font-size: 1.125rem; font-weight: 700; color: var(--gray-900); margin-bottom: 0.5rem;">
                {{ result.name }}
              </h3>
              <p style="color: var(--gray-600); margin-bottom: 1rem; font-size: 0.875rem;">
                {{ result.description }}
              </p>
              <form method="POST" action="{{ url_for('study_groups.join_study_group') }}">
                <input type="hidden" name="group_id" value="{{ result.id }}">
                <button type="submit" class="btn btn-success btn-sm">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="8.5" cy="7" r="4"></circle>
                    <line x1="20" y1="8" x2="20" y2="14"></line>
                    <line x1="23" y1="11" x2="17" y2="11"></line>
                  </svg>
                  Join Group
                </button>
              </form>
            </div>
            {% endfor %}
          </div>
          {% endif %}
        </div>
        {% endif %}
      </div>

      <!-- Create Group -->
      <div class="card">
        <h2 class="card-header">Create New Group</h2>
        
        <form method="POST" action="{{ url_for('study_groups.create_study_group') }}" style="display: flex; flex-direction: column; gap: 1.25rem;">
          <div class="form-group">
            <label class="form-label">Group Name</label>
            <input type="text" 
                   name="group_name" 
                   id="group_name" 
                   class="form-input" 
                   placeholder="e.g., CMPUT 379 Study Group" 
                   required>
          </div>

          <div class="form-group">
            <label class="form-label">Description</label>
            <textarea name="group_description" 
                      id="group_description" 
                      class="form-textarea" 
                      rows="4"
                      placeholder="What's this group about?"></textarea>
          </div>

          <button type="submit" class="btn btn-primary btn-lg" style="width: 100%;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            Create Group
          </button>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}
